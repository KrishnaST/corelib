package com.sil.corelib.test;

import org.kst.corelib.crypt.DUKPT;
import org.kst.corelib.hsm.HSMHelper;
import org.kst.corelib.hsm.HSMUtils;
import org.pmw.tinylog.Logger;

public class HSMTest {

	public static final String DECIMALIZATION_TABLE = "0123456789012345";


	public static void main(String[] args) {
		
		
		System.out.println(HSMHelper.execute("0000DAUB9322774320AB911EC740326592F688C4385B5DB5AEAF80912c2f6c13bb9ba5dad050400088886021801234567890123450000008888N82959FFFFFFFF".toUpperCase()));
		System.exit(0);
		String PIN_LMK = "36100";
				//HSMUtils.encryptPinLMK("1111", "4135080750032932");
		System.out.println("PIN_LMK : "+PIN_LMK);
		String CLEAR_PIN = HSMUtils.decryptPinLMK(PIN_LMK, "4135080750032932");
		
		
		System.exit(0);
		String PVK_LMK		= "U4F12B3A7123D83B504C9F06D899C5D6B";
		String CVK1_LMK 	= "150D8C0DF3348295";
		String CVK2_LMK 	= "B75E6BCE8B0A1D07";
		
		String PAN = "6071020002213576";
		String PIN = "5993";
		String CVV1 = "909";
		String CVV2 = "246";
		String ICVV = "637";
		String serviceCode = "620";
		String pinOffset = "3651";
		String EXPIRY_YYMM = "2112";
		String PINBLOCK_ZPK = "A3CC37D07FEA57C9";
		String ZPK_LMK = "UB27EC3FAB16D5D4D0DFCC5C3246776E3";
		
		//System.out.println(HSMUtils.validatePinBlock_ZPK(PAN, PINBLOCK_ZPK, pinOffset, PVK_LMK, ZPK_LMK));
		
		Logger.info("PAN : " + PAN);
		
		
		
		//HSMUtils.verifyCVV(PAN, EXPIRY_YYMM, CVV1, CVK1_LMK, CVK2_LMK, serviceCode);
		
		
		System.exit(0);
		//System.out.println(HSMUtils.getPinOffset("4181300060041982", "1234", "4385B5DB5AEAF809")); //7644
		//System.out.println(HSMUtils.validatePinBlock_TPK("4135080750032932", "75721790CFFA2BA6", "1440", "UB9322774320AB911EC740326592F688C", "4385B5DB5AEAF809"));
		//System.out.println(HSMUtils.validatePinBlock_TPK("0000007039018911", "84FA65209DA3742E", "7644", "U9D2A7096855DE7F72992A8EEA14A9950", "4385B5DB5AEAF809"));
		
		
		//System.out.println(HSMUtils.validatePinBlock_TPK("4135080750032932", "77D7781C99E7E983", "1440", "U15037305D1D8FD5F5D57C3CB5A92469A","4385B5DB5AEAF809"));
		
		//Dont Delete Hitachi
		//System.out.println(HSMUtils.getPinOffset("5264951717533073", "1234", "4385B5DB5AEAF809"));
		//System.out.println(HSMUtils.validatePinBlock_DUKPT("5264951717533073", "UB387DC23B416D398F17E431C3CB72B93", "4385B5DB5AEAF809", "110000F15CAD88000011", "F1C0BB98E3B61B21", "8917"));
		//Dont Delete
		
		//System.exit(0);
		//System.out.println(HSMUtils.translatePinBlock_DUKPT_ZPK("4135080060005875", "120D98036D7C6BFA", "FFFF9876543210E00002", "UE98A10B12E0A8E28C11A63BE71039817", "U0163EE5553AFBEDB2971BD3E1CDED378"));
		//System.out.println(HSMUtils.validatePinBlock_ZPK("4135080060005875", "F8ADC16806B9CDFC", "1395", "4385B5DB5AEAF809", "U0163EE5553AFBEDB2971BD3E1CDED378"));
		// System.out.println(HSMUtils.generateCVV("5085570020022942", "2103", "B0314C6D17FD9912", "8F1F9E3ECF601CF8", "000"));
		// System.err.println(HSMHelper.execute("0000CYB0314C6D17FD99128F1F9E3ECF601CF83265085570020022942;2103000"));//
	//	System.out.println(HSMUtils.getPinOffset("6521500430015129", "1234", "4385B5DB5AEAF809"));
		System.exit(0);

		// System.out.println(HSMUtils.getTPKTMK_TPKLMK("U1E546687D8129F9EB97FCB0E56AF9367"));
		// System.out.println(PinBlock.getISO1PinBlock("1234"));
		// System.out.println(HSMUtils.validatePinBlock_TPK("4135080750032932", "77D7781C99E7E983", "1440", "U15037305D1D8FD5F5D57C3CB5A92469A",
		// "4385B5DB5AEAF809", "0EC937B5DDD175851CCE96CC2AE02974"));

		// System.out.println(HSMUtils.validatePinBlock_TPK("4135080750032932", "77D7781C99E7E983", "1440", "U15037305D1D8FD5F5D57C3CB5A92469A",
		// "4385B5DB5AEAF809"));

		String BDK_LMK = "UE98A10B12E0A8E28C11A63BE71039817";

		String KSN = "FFFF9876543210E00001";
		String PINBLOCK_DUKPT = "3C2284CCEE41F8AC";
		PINBLOCK_ZPK = "891D51E1DA791D28";
		String PAN12 = "508075003293";

		ZPK_LMK = "U401770057601955CD7797A450474C4E1";
		String PINBLOCK_TPK = "787FA3F7EAA7EBC7";
		String TPK_LMK = "UAE5CF990B772C58DB86C8F6F08392FF9";
		//String PAN = "4135080430018970";
		System.out.println(HSMUtils.translatePinBlock_TPK_ZPK("4135080750032932", PINBLOCK_TPK, TPK_LMK, ZPK_LMK));
		System.out.println(HSMUtils.validatePinBlock_ZPK(PAN, HSMUtils.translatePinBlock_TPK_ZPK("4135080750032932", PINBLOCK_TPK, TPK_LMK, ZPK_LMK), "1440", "4385B5DB5AEAF809", ZPK_LMK));
		System.exit(0);

		String commandG0 = "0000G0" + BDK_LMK + ZPK_LMK + "609" + KSN + PINBLOCK_DUKPT + "0101" + PAN12;
		System.out.println(HSMHelper.execute(commandG0));
		System.out.println(HSMUtils.validatePinBlock_ZPK("4135080750032932", HSMHelper.execute(commandG0).substring(10, 26), "1440", "4385B5DB5AEAF809", ZPK_LMK));

		// System.out.println(HSMUtils.translatePinBlock_DUKPT_ZPK("4135080750032932", PINBLOCK_DUKPT, KSN, BDK_LMK, ZPK_LMK));

		// System.out.println(HSMHelper.execute(commandDA));
	}


	public static void main1(String[] args) throws Exception {

		String PVK_LMK = "4385B5DB5AEAF809";
		String TPK_LMK = "UB9322774320AB911EC740326592F688C";
		String ZPK_LMK = "U401770057601955CD7797A450474C4E1";
		String KSN = "9160470280FFFF000078";
		String BDK = "47E8EB2122696A7D1D718DDB17275F6C";
		String ENC_TRACK2 = "E8E445A4730B46980A6A0F68EAA072DB261DD5BD9C9FD64CF354055A00262D0E89C3355F501F41FD";
		String DEC_TRACK2 = DUKPT.decrypt(KSN, BDK, ENC_TRACK2); // "6521500430015129=21012209450000000000"
		Logger.info("DEC_TRACK2 : " + DEC_TRACK2);
		String PAN = "6521500430015129";
		String PINBLOCK_TPK = "C67AD3F56DCB1475";
		// Logger.info(HSMUtils.validatePinBlock_TPK(PAN, PINBLOCK_TPK, "9215", TPK_LMK, PVK_LMK));

		// Logger.info(HSMUtils.translatePinBlock_TPK_ZPK(PAN, PINBLOCK_TPK, TPK_LMK, ZPK_LMK));
		// Logger.info(HSMUtils.validatePinBlock_ZPK(PAN, HSMUtils.translatePinBlock_TPK_ZPK(PAN, PINBLOCK_TPK, TPK_LMK, ZPK_LMK), "9215", PVK_LMK, ZPK_LMK));
	}


	public static void main233344(String[] args) throws Exception {
		// mainHitachi(new String[1]);

		// System.out.println(HSMUtils.verifyCVV(PAN, EXPIRY_YYMM, CVV, CVK1, CVK2, SERVICE_CODE));
		// 0000CYB0314C6D17FD99128F1F9E3ECF601CF81975085570020022942;2103000
		// 0000CY B0314C6D17FD9912 8F1F9E3ECF601CF8 197 5085570020022942 ;2103 000

	}

}

// TPK_TMK : BA537B2867BB0991F4FFBAD3E32A87B9
// TPK_LMK : U15037305D1D8FD5F5D57C3CB5A92469A

// TPK : B0A1B07037D50D0E0E540889D0D6BFDA
// CLEAR PINBLOCK : 1412343ED6991642
// PINBLOCK : 77D7781C99E7E983
